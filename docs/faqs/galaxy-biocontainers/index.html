<!DOCTYPE html>
<html>
<head>
	<title>Galaxy Integration</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" type='image/x-icon' href="/img/favicon.ico">
	<link rel="stylesheet" type="text/css" href="/docs/css/external/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/docs/css/normalize.css">
	<link rel="stylesheet" type="text/css" href="/docs/css/font-awesome/css/font-awesome.min.css">

	<link rel="stylesheet" type="text/css" href="/docs/css/solarized_dark.css">
	<link rel="stylesheet" type="text/css" href="/docs/css/tutorials.css">
	<link rel="stylesheet" type="text/css" href="/docs/css/style.css">
	<link rel="stylesheet" type="text/css" href="/docs/css/toc.css">

	
		<link rel="stylesheet" href="/docs/{{site.baseurl}}/css/tutorials.css">
	
		<link rel="stylesheet" href="/docs/{{site.baseurl}}/css/solarized_dark.css">
	

	<!-- needed for tutorial specific css -->
	
</head>
<body>	
	

	<!--
	<div class="container" id="main-container">
		<div class="topNavbar">
			<div class="navbar-div" id="logo">
			<a class="logoLink" href="/">BIOJS</a>
			</div>
			<div class="navbar-div" id="navbar-links2">
				<li>
			
			</div>
		</div>
	-->


    <div id="biojs-menu">
<div class="Menu">
        <div class="list">
            <div class="logoDiv">
                <img src="/docs/img/logo.png" id="logoImg">
                <div class="logoDivName">BioContainers Edu.</div>
            </div>


        <span class="item-heading"> Basics </span>
			
	
				<a class="item " href="/docs/101/intro/">Intro</a>
			
	
				<a class="item " href="/docs/101/what_is_biocontainers/">BioContainers?</a>
			
	
				<a class="item " href="/docs/101/getting_started/">User Getting started</a>
			
	
				<a class="item " href="/docs/101/running-example/">BioContainer example</a>
			
	
				<a class="item " href="/docs/101/biocontainers-rkt/">BioContainers in rkt</a>
			
	
				<a class="item " href="/docs/101/biocontainers-architecture/">BioContainers Arch</a>
			
	
				<a class="item " href="/docs/101/biocontainers-registry/">Registry UI</a>
			
		

        <span class="item-heading"> Developer tutorial </span>
			
	
				<a class="item " href="/docs/developer-manual/developer-intro/">Developer Intro</a>
			
	
				<a class="item " href="/docs/developer-manual/biocotainers-dockerfile/">Dockerfile Template</a>
			
	
				<a class="item " href="/docs/developer-manual/best-practices/">Best Practices</a>
			
	
				<a class="item " href="/docs/developer-manual/biocontainers-input-output/">Input/Outpout</a>
			
	
				<a class="item " href="/docs/developer-manual/deploy-dockerhub/">Deploy to DockerHub</a>
			
	
				<a class="item " href="/docs/developer-manual/contributing/">Contributing</a>
			
		

        <span class="item-heading"> BioContainers FAQS </span>
			
	
				<a class="item " href="/docs/faqs/docker-nutshell/">Docker in NutShell</a>
			
	
				<a class="item " href="/docs/faqs/rkt-vs-docker/">rkt vs docker</a>
			
	
				<a class="item item-active" href="/docs/faqs/galaxy-biocontainers/">Galaxy Integration</a>
			
	
				<a class="item " href="/docs/faqs/manually-remove-dockerboot/">Remove boot2docker</a>
			
		

        <span class="item-heading"> Containers Examples </span>
			
	
				<a class="item " href="/docs/containers-examples/DIAUmpire/">DIA-Umpire</a>
			
	
				<a class="item " href="/docs/containers-examples/Comet/">Comet</a>
			
	
				<a class="item " href="/docs/containers-examples/ms-search/">MS Search</a>
			
	
				<a class="item " href="/docs/containers-examples/SNP-Calling/">SNP Calling</a>
			
		

        <span class="item-heading"> Presentations </span>
			
	
				<a class="item " href="/docs/presentations/presentations/">Presentations</a>
			
		
    </div>
</div>

	</div>

	<div id="biojs-main-content">
		
		<div class="heading row">

  <div class="col-md-6 col-xs-7 col-lg-5" id="contentTitleCell">
	  <span class="contentTitle">Galaxy Integration </span>

	  <a class="gitStar" style="width:150px;" href="https://github.com/biocontainers/edu/blob/master/series/faqs/galaxy_container_dependencies.md" target="_blank"><span class="glyphicon glyphicon-pencil" style="font-size:14px;" ></span> Improve this page</a>
  </div>

	<div class="col-xs-2 col-md-3">
		<div id="biojs-iconnav-glyphs">
	  <a class="git" href="https://github.com/biocontainers/" target="_blank"><i class="fa fa-github-alt"></i></a>

	  <a class="git"  href="http://biocontainers.pro" target="_blank"><i class="fa fa-home"></i></a>
	  <a class="git hidden-xs hidden-sm" href="https://kiwiirc.com/client/irc.freenode.net/biocontainers" target="_blank"><i class="fa fa-weixin"></i></a>
	  <a class="git hidden-xs hidden-sm" id="bookmark-link" href="#"><i class="fa fa-bookmark"></i></a>

  </div>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
    $('#bookmark-link').click(function() {
        if (window.sidebar && window.sidebar.addPanel) { // Mozilla Firefox Bookmark
            window.sidebar.addPanel(document.title,window.location.href,'');
        } else if(window.external && ('AddFavorite' in window.external)) { // IE Favorite
            window.external.AddFavorite(location.href,document.title);
        } else if(window.opera && window.print) { // Opera Hotlist
            this.title=document.title;
            return true;
        } else { // webkit - safari/chrome
            alert('Press ' + (navigator.userAgent.toLowerCase().indexOf('mac') != - 1 ? 'Command/Cmd' : 'CTRL') + ' + D to bookmark this page.');
        }
    });
});
</script>

	  <a class="gitStar hidden-xs hidden-sm" style="width:150px;" id="biojs-iconnav-help" href="https://gitter.im/biocontainers/Lobby" target="_blank"><span class="glyphicon glyphicon-bullhorn" style="font-size:17px;" ></span> Get help</a>

  </div>
  <div class="col-md-2 col-lg-2 hidden-xs hidden-sm" id="social-media-share">

    <!-- share it: twitter, google -->
    <div style="height:25px"> <a href="https://twitter.com/share" class="twitter-share-button" style="width: 40px">Tweet</a>

      <script>
        ! function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0],
                    p = /^http:/.test(d.location) ? 'http' : 'https';
                if (!d.getElementById(id)) {
                    js = d.createElement(s);
                    js.id = id;
                    js.src = p + '://platform.twitter.com/widgets.js';
                    fjs.parentNode.insertBefore(js, fjs);
                }
            }(document, 'script', 'twitter-wjs');
      </script>
      <script src="https://apis.google.com/js/platform.js" async defer></script>
	  <div class="share-google-button">
      	<div class="g-plus" data-action="share" data-annotation="bubble"
      data-align="right"></div>
	  </div>
    </div>

    </div>


    <div class="author col-md-2 col-xs-2 hidden-xs">
			<div class="tutorial-item"><span class="glyphicon glyphicon-calendar" style="font-size:14px;margin-bottom: 2px;"></span> 09 Feb 2017</div>
	        
			
	        <div class="tutorial-item"><span class="glyphicon glyphicon-time" style="font-size:14px;margin-bottom: 2px;"></span> 15 minutes </div>
	        
	</div>

</div>

<div class="pullButton pullButton-mob">
	<i class="fa fa-bars fa-2x"></i>
</div>


<div class="containerBody">
	<!--
    <div class="leftPanel">

		

    </div>
	-->
    <div class="rightPanel">



        <div class="static-content">

            <div id="explanation" style="display:none">
                <div style="display:block"><div class="tutorials-highlight" style="display:block;"><span class="glyphicon glyphicon-check" style="float:left;display:block;margin-right:20px"></span><div class="tutorials-highlight-text">
<p>We will use this icon to mark check points.
A check point is a way for you to check how you are doing.</p>
</div></div></div>

<div style="display:block"><div class="tutorials-highlight" style="display:block;"><span class="glyphicon glyphicon-minus-sign" style="float:left;display:block;margin-right:20px"></span><div class="tutorials-highlight-text">
<p>For most of the steps in this tutorial we will
provide the code as it should look after the task. It is tempting, we
know, but please, please, do not go for the “copy&amp;paste” way.</p>
</div></div></div>

<div style="display:block"><div class="tutorials-highlight" style="display:block;"><span class="glyphicon glyphicon-road" style="float:left;display:block;margin-right:20px"></span><div class="tutorials-highlight-text">
<p>We will use this icon to challenge you
with additional code-related tasks so you can go further at your own
pace. No inline answer will be provide for those challenges but we will
give you some guidelines and tips. By the way, within the instructions
we will use <em>an italic font</em> to refer to variables and pieces of code.</p>
</div></div></div>

<div style="display:block"><div class="tutorials-highlight" style="display:block;"><span class="glyphicon glyphicon-bell" style="float:left;display:block;margin-right:20px"></span><div class="tutorials-highlight-text">
<p>We will use this icon to ask you some questions related to the task your are working on.</p>
</div></div></div>

<div style="display:block"><div class="tutorials-highlight" style="display:block;"><span class="glyphicon glyphicon-info-sign" style="float:left;display:block;margin-right:20px"></span><div class="tutorials-highlight-text">
<p>Additional info and resources - this is not essential to complete the tutorial, but very interesting.</p>
</div></div></div>

<div style="display:block"><div class="tutorials-highlight" style="display:block;"><span class="glyphicon glyphicon-gift" style="float:left;display:block;margin-right:20px"></span><div class="tutorials-highlight-text">
<p>Tips that might help you on this task.</p>
</div></div></div>

<div style="display:block"><div class="tutorials-highlight" style="display:block;"><span class="glyphicon glyphicon-hand-up" style="float:left;display:block;margin-right:20px"></span><div class="tutorials-highlight-text">
<p>If you are following this tutorial as part of a workshop, do not hesitate to
raise your hand and share any questions or comments you may have.
If you are doing it by your own, you still can raise your hand in our
mailing list, just join our <a href="https://groups.google.com/forum/#!forum/biojs">Google Group</a>.</p>
</div></div></div>


            </div>

            <div class="clearfix"> </div>

<!--

-->
            <p>================================
Containers for Tool Dependencies
================================</p>

<p>Galaxy tools (also called wrappers) are able to use Conda packages
(see more information in our <code>Galaxy Conda documentation</code><em>) and Docker containers as dependency resolvers.
The IUC</em> recommends to use Conda packages as primary dependency resolver, mainly because Docker is not
available on every (HPC-) system. Conda on the other hand can be installed by Galaxy and maintained
entirely in user-space. Nevertheless, Docker (Containers in general) has some unique features and
there are many use-cases in the Galaxy community which makes containerized systems very appealing.</p>

<p>Since 2014 Galaxy supports running tools in Docker containers via a special <code>container annotation</code>_ inside of the
requirement field.</p>

<pre><code>
    &lt;requirements&gt;
        &lt;!-- Container based dependency handling --&gt;
        &lt;container type="docker"&gt;busybox:ubuntu-14.04&lt;/container&gt;
        &lt;!-- Conda based dependency handling --&gt;
        &lt;requirement type="package" version="8.22"&gt;gnu_coreutils&lt;/requirement&gt;
    &lt;/requirements&gt;

</code></pre>

<p>This approach has shown two limitations that slowed down the adoption by tool developers.
First, every tool needs to be annotated with a container name (as shown above) and this container needs
to be created beforehand, usually manually. The second reason is that a Galaxy tool aims to be deployed everywhere,
independet of the underlying system, meaning if Docker is not available Galaxy should use Conda packages.
This puts an additional burden on tool developers who need to take care of two dependency resolvers. This setup can cause
different tool results depending on the resolver, because both the Conda package and the Docker container are
usually not created out of the same recipe and maybe were compiled in a different way, use different sources etc.</p>

<p>Not an ideal solution and something we wanted to solve.</p>

<p>Here we demonstrate a solution that can create Containers out of Conda packages automatically.
This can be either used to support communities like BioContainers_ to create Containers
before deploying a Galaxy tool, or this can be used by Galaxy to create Containers on-demand and on-the-fly if one
is not available already.</p>

<h2 id="automatic-build-of-linux-containers">Automatic build of Linux containers</h2>

<p>We utilize <a href="https://github.com/mulled/mulled">mulled</a> with <a href="https://github.com/involucro/involucro">involucro</a>
in an automatic way. This is for example used to convert all packages in bioconda_ into Linux Containers
(Docker and rkt at the moment) and made available at the <code>BioContainers Quay.io account</code>_.</p>

<p>We have developed small utilities around this technology stack which is currently included in galaxy-lib_.
Here is a short introduction:</p>

<h2 id="search-for-containers">Search for containers</h2>

<p>This will search for containers in the biocontainers organisation.</p>

<pre><code>
$ mulled-search -s vsearch -o biocontainers

</code></pre>

<h2 id="build-all-packages-from-bioconda-from-the-last-24h">Build all packages from bioconda from the last 24h</h2>

<p>The BioConda community is building a container for every package they create with a command similar to this.</p>

<pre><code>
$ mulled-build-channel --channel bioconda --namespace biocontainers \
      --involucro-path ./involucro --recipes-dir ./bioconda-recipes --diff-hours 25 build

</code></pre>

<h2 id="building-docker-containers-for-local-conda-packages">Building Docker containers for local Conda packages</h2>

<p>Conda packages can be tested with creating a busybox based container for this particular package in the following way.
This also demonstrates how you can build a container locally and on-the-fly.</p>

<blockquote>
  <p>we modified the samtools package to version 3.0 to make clear we are using a local version</p>
</blockquote>

<p>1) build your recipe</p>

<pre><code>$ conda build recipes/samtools
</code></pre>

<p>2) index your local builds</p>

<pre><code>$ conda index /home/bag/miniconda2/conda-bld/linux-64/
</code></pre>

<p>3) build a container for your local package</p>

<pre><code>$ mulled-build build-and-test 'samtools=3.0--0' \
      --extra-channel file://home/bag/miniconda2/conda-bld/ --test 'samtools --help'
</code></pre>

<p>The <code>--0</code> indicates the build version of the conda package. It is recommended to specify this number otherwise
you will override already existing images. For Python Conda packages this extension might look like this <code>--py35_1</code>.</p>

<h2 id="build-test-and-push-a-conda-forge-package-to-biocontainers">Build, test and push a conda-forge package to biocontainers</h2>

<blockquote>
  <p>You need to have write access to the biocontainers repository</p>
</blockquote>

<p>You can build packages from other Conda channels as well, not only from BioConda. <code>pandoc</code> is available from the
conda-forge channel and conda-forge is also enabled by default in Galaxy. To build <code>pandoc</code> and push it to biocontainrs
you could do something along these lines.</p>

<pre><code>
   $ mulled-build build-and-test 'pandoc=1.17.2--0' --test 'pandoc --help' -n biocontainers
   $ mulled-build push 'pandoc=1.17.2--0' --test 'pandoc --help' -n biocontainers
</code></pre>

<ul>
  <li>Galaxy Conda documentation: ./conda_faq.rst</li>
  <li>IUC: https://wiki.galaxyproject.org/IUC</li>
  <li>container annotation:  https://github.com/galaxyproject/galaxy/blob/dev/test/functional/tools/catDocker.xml#L4</li>
  <li>BioContainers: https://github.com/biocontainers</li>
  <li>bioconda: https://github.com/bioconda/bioconda-recipes</li>
  <li>BioContainers Quay.io account: https://quay.io/organization/biocontainers</li>
  <li>galaxy-lib: https://github.com/galaxyproject/galaxy-lib</li>
</ul>


           <div id="lower-link-box" class="link-box">
				
				<a href="/docs/faqs/rkt-vs-docker/" class="btn btn-primary previous-link">Previous</a>
				
				
					<a href="/docs/faqs/manually-remove-dockerboot/" class="btn btn-primary next-link pull-right">Next</a>
				

				<br />
			</div>

		</div>
	</div>

<!-- temporaroy removed

-->

<script>
document.addEventListener("DOMContentLoaded", function() {
	// load highlighted code blocks
    $('pre code').each(function(i, block) {
      hljs.highlightBlock(block);
    });
	jQuery(".collapsible").each(function(i,e){
		collapseStuff(e,"Hide the code", "Display the code");
	});
	/*
	DO NOT show the explanation
	collapseStuff("#explanation","Hide the icon explanation", "Display the icon explanation");
	jQuery("#explanation").css("display", "block");
	*/
});
function collapseStuff(e, textHidden, textDisplayed){
	var divHigh = $(e);
	var children = divHigh.children();
	children.hide();
	var toggleBox = document.createElement("div");
	toggleBox.className = "tutorials-togglebox";
	divHigh.prepend(toggleBox);
	var awesomeIcon = document.createElement("span");
	var awesomeText= document.createElement("span");
	awesomeIcon.className = "tutorials-togglebox-icon glyphicon glyphicon-chevron-down";
	awesomeText.textContent = "Display the code";
	awesomeText.className = "tutorials-togglebox-text";
	toggleBox.appendChild(awesomeIcon);
	toggleBox.appendChild(awesomeText);
	awesomeText.textContent = textDisplayed;
	$(toggleBox).click(function(){
		var codeBox = children;
		var text = divHigh.children().first();
		if( codeBox.css("display") == "none" ){
			codeBox.show(700);
			awesomeText.textContent = textHidden;
			awesomeIcon.className = "tutorials-togglebox-icon glyphicon glyphicon-chevron-up";
		}else{
			codeBox.hide(500);
			awesomeText.textContent = textDisplayed;
			awesomeIcon.className = "tutorials-togglebox-icon glyphicon glyphicon-chevron-down";
		}
	});
};
</script>

<script src="/docs/js/highlight.min.js"></script>

	</div>
		
		</div>
		<!--
		<div class="footer">
			<div class="improve-this-page">
				<span class="glyphicon glyphicon-pencil"></span> <a href="https://github.com/biojs/edu/blob/master/series/faqs/galaxy_container_dependencies.md">Improve this page</a>
			</div>

			<div id="privacy-notice-less" class="privacy-policy">
				Privacy Policy.
			</div>
			<div id="privacy-notice-more"  class="privacy-policy" style="display:none">
				This website uses Google Analytics to collect anonymous visiting stats.<br />
				By visiting this site you agree to the <a href="https://www.google.com/analytics/terms/us.html">data processing agreement</a> by Google.<br />
				If you do not agree, <a href="http://www.usa.gov/optout-instructions.shtml">opt out</a>.
			</div>
		
		</div>
		-->


	<script type="text/javascript" src="/docs/js/jquery.min.js"></script>
	<script type="text/javascript" src="/docs/js/highlight.min.js"></script>
	<script type="text/javascript" src="/docs/js/jquery-scrollspy.js"></script>
	<script type="text/javascript" src="/docs/js/bottom.js"></script>
	<script type="text/javascript" src="/docs/js/bootstrap.min.js"></script>

			<script type="text/javascript">
	        $(document).ready(function() {
        			$('.color').each(function(i) {
        				var position = $(this).position();
        				console.log(position);
        				console.log('min: ' + position.top + ' / max: ' + parseInt(position.top + $(this).height()));
        				$(this).scrollspy({
        					min: position.top,
        					max: position.top + $(this).height(),
        					onEnter: function(element, position) {
        						if(console) console.log('entering ' +  element.id);
        						$("body").css('background-color', element.id);
        					},
        					onLeave: function(element, position) {
        						if(console) console.log('leaving ' +  element.id);
        					//	$('body').css('background-color','#eee');
        					}
        				});
        			});
        		});
        	</script>
	<script type="text/javascript">

		/*
		$(window).scroll(function(){
    		$(".topNavbar").css({"top": ($(window).scrollTop()) + "px"});        
    		if ($(window).scrollTop() > 140){
	    		$(".leftPanel").css({"top": ($(window).scrollTop()) -140 + "px"});
			}
    	});
    	*/

		$('.pullButton').click(function(e){
			$("#biojs-menu").css("display","block");
			$("#biojs-main-content").css("margin-left","220px");
			$(".pullButton").removeClass("pullButton-mob");
			e.stopPropagation();
			return false;
		});

		$(window).click(function(){
			closeMenu();
		});
		$('.Menu').click(function(){
			closeMenu();
		});

		function closeMenu(){
			if(isMobile()){
				$("#biojs-menu").css("display","none");
				$(".pullButton").addClass("pullButton-mob");
				$("#biojs-main-content").css("margin-left","0px");
			}
		}
		function isMobile(){
			return $(window).width() <= 600;
		}

	</script>


	


	<script>hljs.initHighlightingOnLoad();</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51509688-5', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>
