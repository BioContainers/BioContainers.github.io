<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="">
    <meta name="keywords" content="">
    <title>BioDocker best practices </title>
    <link rel="shortcut icon" href="../images/favicon.png" type="image/png">
    <link rel="stylesheet" href="../dist/assets/css/app.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.2.6/animate.min.css">
    <link rel="stylesheet" href="../css/custom.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="../dist/assets/js/modernizr.js"></script>
</head>
<body>
  <div class="off-canvas-wrap" data-offcanvas>
    <div class="inner-wrap">

      <a class="left-off-canvas-toggle" href="#" >
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="35px" height="35px" viewBox="0 0 35 35" enable-background="new 0 0 35 35" xml:space="preserve">
          <path fill="#3597D4" d="M30.583,9.328c0,0.752-0.539,1.362-1.203,1.362H5.113c-0.664,0-1.203-0.61-1.203-1.362l0,0
          c0-0.752,0.539-1.362,1.203-1.362H29.38C30.045,7.966,30.583,8.576,30.583,9.328L30.583,9.328z"/>
          <path fill="#3597D4" d="M30.583,17.09c0,0.752-0.539,1.362-1.203,1.362H5.113c-0.664,0-1.203-0.61-1.203-1.362l0,0
          c0-0.752,0.539-1.362,1.203-1.362H29.38C30.045,15.728,30.583,16.338,30.583,17.09L30.583,17.09z"/>
          <path fill="#3597D4" d="M30.583,24.387c0,0.752-0.539,1.362-1.203,1.362H5.113c-0.664,0-1.203-0.61-1.203-1.362l0,0
          c0-0.752,0.539-1.362,1.203-1.362H29.38C30.045,23.025,30.583,23.635,30.583,24.387L30.583,24.387z"/>
        </svg>
      </a>
      <a class="button secondary small get-started-cta">Get Started</a>
      <header class="main-header">
        <div class="row">
          <div class="large-3 columns">
            <a href="http://biodocker.org/"><img class="logo" src="../dist/assets/images/logo.png"></a>
          </div>
          <div class="large-9 columns">
            <ul class="nav-global">
              <li><a class="button" href="../quick-start-users/">Get Started</a></li>
            </ul>
            <ul class="nav-main">
              <li><a href="../what-is-biodocker/">BioDocker</a>
                <ul>
                  <li><a href="../what-is-biodocker/">What is Docker?</a></li>
                  <li><a href="../biodocker-history/">BioDocker History</a></li>
                </ul>
              </li>
              
              <li><a href="https://github.com/biodocker">GitHub</a>
                <ul>
                  <li><a href="https://github.com/BioDocker/biodocker">Specification</a></li>
                  <li><a href="https://github.com/BioDocker/containers">Containers</a></li>
                  <li><a href="https://github.com/BioDocker/sandbox">Sandbox</a></li>
                  <li><a href="https://github.com/BioDocker/containers/issues">Issues</a></li>
                </ul>
              </li>
              <li><a href="https://hub.docker.com/u/biodckr/">Registry</a>

              </li>
            </ul>
          </div>
        </div>
      </header>

      
      <aside class="left-off-canvas-menu">
        <ul class="off-canvas-list">
          <li class="has-submenu"><a href="../what-is-biodocker/">BioDocker</a>
            <ul class="left-submenu">
              <li class="back"><a href="#">Back</a></li>
              <li><a href="../what-is-biodocker/">What is Docker?</a></li>
              <li><a href="../biodocker-history/">BioDocker History</a></li>
              <li><a href="../quick-start-users/">Get Started</a></li>
              <li><a href="https://github.com/biodocker">GitHub</a></li>
              <li><a href="https://github.com/BioDocker/biodocker">Specification</a></li>
              <li><a href="https://github.com/BioDocker/containers">Containers</a></li>
              <li><a href="https://github.com/BioDocker/sandbox">Sandbox</a></li>
              <li><a href="https://github.com/BioDocker/containers/issues">Issues</a></li>
              <li><a href="https://hub.docker.com/u/biodckr/">Registry</a></li>o
            </ul>
          </li>
        </ul>

      </aside>
      
      <a class="exit-off-canvas"></a>

<div id="docs" class="row">
    <div class="large-3 columns">
        <section id="multiple" data-accordion-group>
  
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Getting Started</button>
          <div data-content>
            
              
                <a data-link href="../what-is-biodocker/" class=""> What is BioDocker?</a>
              
            
              
                <a data-link href="../biodocker-history/" class=""> BioDocker History</a>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Docker in NutShell</button>
          <div data-content>
            
              
                <a data-link href="../docker-in-nutshell/" class=""> Docker in NutShell</a>
              
            
              
                <a data-link href="../docker-install/" class=""> How to Install Docker?</a>
              
            
              
                <a data-link href="../docker-client/" class=""> Learn about Docker Client</a>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Quickstart Guide</button>
          <div data-content>
            
              
                <a data-link href="../biodocker-registry/" class=""> Biodocker Registry</a>
              
            
              
                <a data-link href="../quick-start-users/" class=""> Users Quick Start</a>
              
            
              
                <a data-link href="../biodocker-input-output/" class=""> Using input  and Output files</a>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> Guide for Developers</button>
          <div data-content>
            
              
                <a data-link href="../biodocker-docker-template/" class=""> Biodocker dockerfile template</a>
              
            
              
                <a data-link href="../biodocker-best-practices/" class=" active"> BioDocker best practices</a>
              
            
              
                <a data-link href="../biodocker-deploy-new/" class=""> Deploying a new Project</a>
              
            
          </div>
        </article>
       
    </section>
  
    <section data-accordion>
      
        <article data-accordion>
          <button data-control> About</button>
          <div data-content>
            
              
                <a data-link href="../release-notes/" class=""> About BioDocker</a>
              
            
          </div>
        </article>
       
    </section>
  
</section>

<script>
$(document).ready(function () {
  var $activeLink = $('#multiple [data-link].active');
  var $accordions = $activeLink.parents('article[data-accordion]');
  $($accordions.get().reverse()).each(function (index, accordion) {
    var $accordion = $(accordion);
    var $content = $accordion.find('[data-content]');
    $accordion.addClass('open');
    $content.css({'max-height': '100%'});
  });
});
</script>

    </div>
    <div class="large-6 columns">
      <section id="main">
        <article id="content">
          

<h1 id="best-practices">Best Practices</h1>

<h2 id="language-specific">Language Specific</h2>

<h3 id="python">Python</h3>

<ul>
<li>Use requirements.txt instead of listing dependencies</li>
<li>Define library versions</li>
</ul>

<h2 id="optimization">Optimization</h2>

<ul>
<li>Use environment variables to avoid repeating yourself</li>
</ul>

<p>This is a trick I picked up from reading the Dockerfile (link) of the &ldquo;official&rdquo; node.js docker image. As an aside, this Dockerfile is great. My only criticism is that it sits on top of a huge buildpack-deps (link) image, with all sorts of things I don&rsquo;t want or need.</p>

<p>You can define environment variables with ENV and then reference them in subsequent RUN commands. Below, I&rsquo;ve paraphrased an excerpt from the linked Dockerfile:</p>

<pre><code class="language-bash">ENV NODE_VERSION 0.10.32

RUN curl -SLO &quot;http://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.gz&quot; &amp;&amp; \
    tar -xzf &quot;node-v$NODE_VERSION-linux-x64.tar.gz&quot; -C /usr/local --strip-components=1 &amp;&amp; \
    rm &quot;node-v$NODE_VERSION-linux-x64.tar.gz&quot;
</code></pre>

<ul>
<li>Merge RUN commands:</li>
</ul>

<p>instead of running:</p>

<pre><code class="language-bash">RUN acb
RUN cbd
RUN bde
</code></pre>

<p>run:</p>

<pre><code>RUN acb &amp;&amp; cbd &amp;&amp; bde
</code></pre>

<p>or:</p>

<pre><code>RUN acb &amp;&amp; \
    cbd &amp;&amp; \
    bde
</code></pre>

<ul>
<li>Whenever possible, reuse the same base image and use a LTS (Long Term Support) image preferably (Ubuntu 12.04 or 14.04)</li>
<li>You can use our biodckr/biodocker image based on ubuntu 14.04 with frequent updates and default folders created</li>
<li>Use a .dockerignore file: In most cases, it’s best to put each Dockerfile in an empty directory. Then, add to that directory only the files needed for building the Dockerfile. To increase the build’s performance, you can exclude files and directories by adding a .dockerignore file to that directory as well. This file supports exclusion patterns similar to .gitignore files. For information on creating one, see the .dockerignore file.</li>
<li>Avoid installing unnecessary packages: In order to reduce complexity, dependencies, file sizes, and build times, you should avoid installing extra or unnecessary packages just because they might be “nice to have.” For example, you don’t need to include a text editor in a database image.</li>
<li>Run only one process per container: In almost all cases, you should only run a single process in a single container. Decoupling applications into multiple containers makes it much easier to scale horizontally and reuse containers. If that service depends on another service, make use of container linking.</li>
<li>Minimize the number of layers: You need to find the balance between readability (and thus long-term maintainability) of the Dockerfile and minimizing the number of layers it uses. Be strategic and cautious about the number of layers you use.</li>
<li>Sort multi-line arguments: Whenever possible, ease later changes by sorting multi-line arguments alphanumerically. This will help you avoid duplication of packages and make the list much easier to update. This also makes PRs a lot easier to read and review. Adding a space before a backslash () helps as well.</li>
</ul>

<p>Here’s an example from the buildpack-deps image:</p>

<pre><code class="language-bash">RUN apt-get update &amp;&amp; apt-get install -y \
    bzr \
    cvs \
    git \
    mercurial \
    subversion
</code></pre>

<blockquote>
<p>Note: Don&rsquo;t install build tools without good reason:
Build tools take up a lot of space, and building from source is often slow. If you&rsquo;re just installing somebody else&rsquo;s software, it&rsquo;s usually not necessary to build from source and it should be avoided. For instance, it is not necessary to install python, gcc, etc. to get the latest version of node.js up and running on a Debian host. There is a binary tarball available on the node.js downloads page. Similarly, redis can be installed through the package manager.</p>
</blockquote>

<p>There are at least a few good reasons to have build tools:</p>

<ul>
<li>you need a specific version (e.g. redis is pretty old in the Debian repositories).</li>
<li>you need to compile with specific options.</li>
<li>you will need to npm install (or equivalent) some modules which compile to binary.</li>
</ul>

<p>In the second case, think really hard about whether you should be doing that. In the third case, I suggest installing the build tools in another &ldquo;npm installer&rdquo; image, based on the minimal node.js image.</p>

<p>Don&rsquo;t leave temporary files lying around</p>

<p>The following Dockerfile results in an image size of 109 MB:</p>

<pre><code class="language-bash">FROM debian:wheezy
RUN apt-get update &amp;&amp; apt-get install -y wget
RUN wget http://cachefly.cachefly.net/10mb.test
RUN rm 10mb.test
</code></pre>

<p>On the other hand, this seemingly-equivalent Dockerfile results in an image size of 99 MB:</p>

<pre><code class="language-bash">FROM debian:wheezy
RUN apt-get update &amp;&amp; apt-get install -y wget
RUN wget http://cachefly.cachefly.net/10mb.test &amp;&amp; rm 10mb.test
</code></pre>

<p>Thus it seems that if you leave a file on disk between steps in your Dockerfile, the space will not be reclaimed when you delete the file. It is also often possible to avoid a temporary file entirely, just piping output between commands. For instance,</p>

<pre><code class="language-bash">wget -O - http://nodejs.org/dist/v0.10.32/node-v0.10.32-linux-x64.tar.gz | tar zxf -
</code></pre>

<ul>
<li>Clean up after the package manager</li>
</ul>

<p>If you run apt-get update in setting up your container, it populates /var/lib/apt/lists/ with data that&rsquo;s not needed once the image is finalized. You can safely clear out that directory to save a few megabytes.</p>

<p>This Dockerfile generates a 99 MB image:</p>

<pre><code class="language-bash">FROM debian:wheezy
RUN apt-get update &amp;&amp; apt-get install -y wget
</code></pre>

<p>while this one generates a 90 MB image:</p>

<pre><code>FROM debian:wheezy
RUN apt-get update &amp;&amp; apt-get install -y wget &amp;&amp; apt-get clean &amp;&amp; apt-get purge &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
</code></pre>

<ul>
<li>Pin package versions</li>
</ul>

<p>While a docker image is immutable (and that&rsquo;s great), a Dockerfile is not guaranteed to produce the same output when run at different times. The problem, of course, is external state, and we have little control over it. It&rsquo;s best to minimize the impact of external state on your Dockerfile to the extent that it&rsquo;s possible. One simple way to do that is to pin package versions when updating through a package manager. Here&rsquo;s an example of how to do that:</p>

<pre><code class="language-bash"># apt-get update
# apt-cache showpkg redis-server
Package: redis-server
Versions:
2:2.4.14-1
# apt-get install redis-server=2:2.4.14-1
</code></pre>

<ul>
<li>Map log files outside</li>
</ul>

<h2 id="general">General</h2>

<ul>
<li>ADD vs COPY: Both ADD and COPY adds local files when building a container but ADD does some additional magic like adding remote files and ungzipping and untaring archives. Only use ADD if you understand this difference.</li>
<li>WORKDIR and ENV: Each command will create a new temporary image and runs in a new shell hence if you do a cd <directory> or export <var>=<value> in your Dockerfile it won&rsquo;t work. Use WORKDIR to set your working directory across multiple commands and ENV to set environment variables.</li>
<li>CMD and ENTRYPOINT: CMD is the default command to execute when an image is run. The default ENTRYPOINT is /bin/sh -c and CMD is passed into that as an argument. We can override ENTRYPOINT in our Dockerfile and make our container behave like an executable taking command line arguments (with default arguments in CMD in our Dockerfile).</li>
<li>ADD your code last: ADD invalidates your cache if files have changed. Don&rsquo;t invalidate the cache by adding frequently changing stuff too high up in your Dockerfile. Add your code last, libraries and dependencies first. For node.js apps that means adding your package.json first, running npm install and only then adding your code.</li>
<li>USER in Dockerfiles: By default docker runs everything as root but you can use USER in Dockerfiles. There&rsquo;s no user namespacing in docker so the container sees the users on the host but only uids hence you need the add the users in the container.</li>
<li>CMD: The CMD instruction should be used to run the software contained by your image, along with any arguments. CMD should almost always be used in the form of CMD [“executable”, “param1”, “param2”…]. Thus, if the image is for a service (Apache, Rails, etc.), you would run something like CMD [&ldquo;apache2&rdquo;,&ldquo;-DFOREGROUND&rdquo;]. Indeed, this form of the instruction is recommended for any service-based image.</li>
<li>ENV: In order to make new software easier to run, you can use ENV to update the PATH environment variable for the software your container installs. For example, ENV PATH /usr/local/nginx/bin:$PATH will ensure that CMD [“nginx”] just works. The ENV instruction is also useful for providing required environment variables specific to services you wish to containerize, such as Postgres’s PGDATA.</li>
<li>USER: If a service can run without privileges, use USER to change to a non-root user. Start by creating the user and group in the Dockerfile with something like</li>
</ul>

<pre><code class="language-bash">RUN groupadd -r postgres &amp;&amp; useradd -r -g postgres postgres.
</code></pre>

<blockquote>
<p>Note: Users and groups in an image get a non-deterministic UID/GID in that the “next” UID/GID gets assigned regardless of image rebuilds. So, if it’s critical, you should assign an explicit UID/GID.
You should avoid installing or using sudo since it has unpredictable TTY and signal-forwarding behavior that can cause more problems than it solves. If you absolutely need functionality similar to sudo (e.g., initializing the daemon as root but running it as non-root), you may be able to use “gosu”.</p>
</blockquote>

<p>Lastly, to reduce layers and complexity, avoid switching USER back and forth frequently.</p>

<ul>
<li>WORKDIR: For clarity and reliability, you should always use absolute paths for your WORKDIR. Also, you should use WORKDIR instead of proliferating instructions like RUN cd … &amp;&amp; do-something, which are hard to read, troubleshoot, and maintain.</li>
</ul>

<h2 id="volumes">Volumes</h2>

<ul>
<li>Should always map to the same /data and /config folders</li>
<li>Should be RW (read/write) unless there&rsquo;s a good reason not to</li>
<li>Config and Log files can be mapped to the host but should preferentially be symbolically linked to the /data or /config folder</li>
<li>Additional mappings can be created if necessary</li>
</ul>

<h2 id="images">Images</h2>

<ul>
<li>Images should be based on the latest LTS image available (Ubuntu 12.04 and 14.04) or to one of our images</li>
</ul>

<h2 id="sources-and-useful-links">Sources and Useful Links</h2>

<p><a href="https://github.com/veggiemonk/awesome-docker#optimizing-images">https://github.com/veggiemonk/awesome-docker#optimizing-images</a></p>

<p><a href="https://labs.ctl.io/optimizing-docker-images/?hvid=1OW0br">https://labs.ctl.io/optimizing-docker-images/?hvid=1OW0br</a></p>

<p><a href="https://docs.docker.com/articles/dockerfile_best-practices/">https://docs.docker.com/articles/dockerfile_best-practices/</a></p>

<p><a href="http://csaba.palfi.me/random-docker-tips/">http://csaba.palfi.me/random-docker-tips/</a></p>

<p><a href="https://docs.docker.com/articles/dockerfile_best-practices/">https://docs.docker.com/articles/dockerfile_best-practices/</a></p>

<p><a href="http://jonathan.bergknoff.com/journal/building-good-docker-images">http://jonathan.bergknoff.com/journal/building-good-docker-images</a></p>

        </article>
		  </section>
    </div>
    <div id="toc" class="large-3 columns toc ">
     On this page:
        <nav id="TableOfContents">
<ul>
<li><a href="#best-practices">Best Practices</a>
<ul>
<li><a href="#language-specific">Language Specific</a>
<ul>
<li><a href="#python">Python</a></li>
</ul></li>
<li><a href="#optimization">Optimization</a></li>
<li><a href="#general">General</a></li>
<li><a href="#volumes">Volumes</a></li>
<li><a href="#images">Images</a></li>
<li><a href="#sources-and-useful-links">Sources and Useful Links</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

<footer class="main-footer">
  <div class="row">
  </div>
  <div class="row">
  </div>
</footer>
<link rel="stylesheet" href="../highlight/styles/github.css">
<script src="../highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="../dist/assets/js/all.js"></script>
<script>
  $( 'nav li:has(ul)' ).doubleTapToGo();
</script>
<script>

;(function ( $, window, document, undefined ) {

    var pluginName = 'accordion',
        defaults = {
            transitionSpeed: 300,
            transitionEasing: 'ease',
            controlElement: '[data-control]',
            contentElement: '[data-content]',
            groupElement: '[data-accordion-group]',
            singleOpen: true
        };

    function Accordion(element, options) {
        this.element = element;
        this.options = $.extend({}, defaults, options);
        this._defaults = defaults;
        this._name = pluginName;
        this.init();
    }

    Accordion.prototype.init = function () {
        var self = this,
            opts = self.options;

        var $accordion = $(self.element),
            $controls = $accordion.find('> ' + opts.controlElement),
            $content =  $accordion.find('> ' + opts.contentElement);

        var accordionParentsQty = $accordion.parents('[data-accordion]').length,
            accordionHasParent = accordionParentsQty > 0;

        var closedCSS = { 'max-height': 0, 'overflow': 'hidden' };

        var CSStransitions = supportsTransitions();

        function debounce(func, threshold, execAsap) {
            var timeout;

            return function debounced() {
                var obj = this,
                    args = arguments;

                function delayed() {
                    if (!execAsap) func.apply(obj, args);
                    timeout = null;
                };

                if (timeout) clearTimeout(timeout);
                else if (execAsap) func.apply(obj, args);

                timeout = setTimeout(delayed, threshold || 100);
            };
        }

        function supportsTransitions() {
            var b = document.body || document.documentElement,
                s = b.style,
                p = 'transition';

            if (typeof s[p] == 'string') {
                return true;
            }

            var v = ['Moz', 'webkit', 'Webkit', 'Khtml', 'O', 'ms'];

            p = 'Transition';

            for (var i=0; i<v.length; i++) {
                if (typeof s[v[i] + p] == 'string') {
                    return true;
                }
            }

            return false;
        }

        function requestAnimFrame(cb) {
            if(window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame) {
                return  requestAnimationFrame(cb) ||
                        webkitRequestAnimationFrame(cb) ||
                        mozRequestAnimationFrame(cb);
            } else {
                return setTimeout(cb, 1000 / 60);
            }
        }

        function toggleTransition($el, remove) {
            if(!remove) {
                $content.css({
                    '-webkit-transition': 'max-height ' + opts.transitionSpeed + 'ms ' + opts.transitionEasing,
                    'transition': 'max-height ' + opts.transitionSpeed + 'ms ' + opts.transitionEasing
                });
            } else {
                $content.css({
                    '-webkit-transition': '',
                    'transition': ''
                });
            }
        }

        function calculateHeight($el) {
            var height = 0;

            $el.children().each(function() {
                height = height + $(this).outerHeight(true);
            });

            $el.data('oHeight', height);
        }

        function updateParentHeight($parentAccordion, $currentAccordion, qty, operation) {
            var $content = $parentAccordion.filter('.open').find('> [data-content]'),
                $childs = $content.find('[data-accordion].open > [data-content]'),
                $matched;

            if(!opts.singleOpen) {
                $childs = $childs.not($currentAccordion.siblings('[data-accordion].open').find('> [data-content]'));
            }

            $matched = $content.add($childs);

            if($parentAccordion.hasClass('open')) {
                $matched.each(function() {
                    var currentHeight = $(this).data('oHeight');

                    switch (operation) {
                        case '+':
                            $(this).data('oHeight', currentHeight + qty);
                            break;
                        case '-':
                            $(this).data('oHeight', currentHeight - qty);
                            break;
                        default:
                            throw 'updateParentHeight method needs an operation';
                    }

                    $(this).css('max-height', $(this).data('oHeight'));
                });
            }
        }

        function refreshHeight($accordion) {
            if($accordion.hasClass('open')) {
                var $content = $accordion.find('> [data-content]'),
                    $childs = $content.find('[data-accordion].open > [data-content]'),
                    $matched = $content.add($childs);

                calculateHeight($matched);

                $matched.css('max-height', $matched.data('oHeight'));
            }
        }

        function closeAccordion($accordion, $content) {
            $accordion.trigger('accordion.close');
            
            if(CSStransitions) {
                if(accordionHasParent) {
                    var $parentAccordions = $accordion.parents('[data-accordion]');

                    updateParentHeight($parentAccordions, $accordion, $content.data('oHeight'), '-');
                }

                $content.css(closedCSS);

                $accordion.removeClass('open');
            } else {
                $content.css('max-height', $content.data('oHeight'));

                $content.animate(closedCSS, opts.transitionSpeed);

                $accordion.removeClass('open');
            }
        }

        function openAccordion($accordion, $content) {
            $accordion.trigger('accordion.open');
            if(CSStransitions) {
                toggleTransition($content);

                if(accordionHasParent) {
                    var $parentAccordions = $accordion.parents('[data-accordion]');

                    updateParentHeight($parentAccordions, $accordion, $content.data('oHeight'), '+');
                }

                requestAnimFrame(function() {
                    $content.css('max-height', $content.data('oHeight'));
                });

                $accordion.addClass('open');
            } else {
                $content.animate({
                    'max-height': $content.data('oHeight')
                }, opts.transitionSpeed, function() {
                    $content.css({'max-height': 'none'});
                });

                $accordion.addClass('open');
            }
        }

        function closeSiblingAccordions($accordion) {
            var $accordionGroup = $accordion.closest(opts.groupElement);

            var $siblings = $accordion.siblings('[data-accordion]').filter('.open'),
                $siblingsChildren = $siblings.find('[data-accordion]').filter('.open');

            var $otherAccordions = $siblings.add($siblingsChildren);

            $otherAccordions.each(function() {
                var $accordion = $(this),
                    $content = $accordion.find(opts.contentElement);

                closeAccordion($accordion, $content);
            });

            $otherAccordions.removeClass('open');
        }

        function toggleAccordion() {
            var isAccordionGroup = (opts.singleOpen) ? $accordion.parents(opts.groupElement).length > 0 : false;

            calculateHeight($content);

            if(isAccordionGroup) {
                closeSiblingAccordions($accordion);
            }

            if($accordion.hasClass('open')) {
                closeAccordion($accordion, $content);
            } else {
                openAccordion($accordion, $content);
            }
        }

        function addEventListeners() {
            $controls.on('click', toggleAccordion);
            
            $controls.on('accordion.toggle', function() {
                if(opts.singleOpen && $controls.length > 1) {
                    return false;
                }
                
                toggleAccordion();
            });

            $(window).on('resize', debounce(function() {
                refreshHeight($accordion);
            }));
        }

        function setup() {
            $content.each(function() {
                var $curr = $(this);

                if($curr.css('max-height') != 0) {
                    if(!$curr.closest('[data-accordion]').hasClass('open')) {
                        $curr.css({ 'max-height': 0, 'overflow': 'hidden' });
                    } else {
                        toggleTransition($curr);
                        calculateHeight($curr);

                        $curr.css('max-height', $curr.data('oHeight'));
                    }
                }
            });


            if(!$accordion.attr('data-accordion')) {
                $accordion.attr('data-accordion', '');
                $accordion.find(opts.controlElement).attr('data-control', '');
                $accordion.find(opts.contentElement).attr('data-content', '');
            }
        }

        setup();
        addEventListeners();
    };

    $.fn[pluginName] = function ( options ) {
        return this.each(function () {
            if (!$.data(this, 'plugin_' + pluginName)) {
                $.data(this, 'plugin_' + pluginName,
                new Accordion( this, options ));
            }
        });
    }

})( jQuery, window, document );

$(document).ready(function() {
  $('#multiple [data-accordion]').accordion({
    singleOpen: false
  });
});

</script>


<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-WLGFZV"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WLGFZV');
</script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-52449822-1', 'auto');
    ga('send', 'pageview');
</script>

